title: WMI_Persistence
id: 470d4b3d-77f3-43f1-8334-f8f5c81a7a4f
status: stable
description: |
  Detects suspicious WMI event filter and command line event consumer based on event id 5861 and 5859 (Windows 10, 2012 and higher)
references:
  - https://twitter.com/mattifestation/status/899646620148539397
  - https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/
author: Florian Roth
date: 2019-10-22
logsource:
  category: Microsoft-Windows-WMI-Activity/Operational
  product: Microsoft-Windows-WMI-Activity
detection:
  selection:
    EventID:
      - '5861'
    UserData.Operation_ESStoConsumerBinding.CONSUMER:
      - "*ActiveScriptEventConsumer*"
      - "*CommandLineEventConsumer*"
    UserData.Operation_ESStoConsumerBinding.PossibleCause:
      - "*CommandLineTemplate*"
